#!/bin/bash
set -eu
# Check directory
cd "$(dirname "$0")"
[ -d .git ] || cd ../..
[ -d .git ]
[ "$(basename "$0")" != 'commit-msg' ] || set -- commit-msg "$@"

case "${1:-run}" in
	run) ;;
	commit-msg)
		echo "Commit msg file: $2"
		exit;;
	install)
		echo "Installing pre-commit (and commit-msg)"
		(cd .git/hooks && ln -sf ../../pre-commit pre-commit && ln -sf ../../pre-commit commit-msg)
		exit;;
	uninstall)
		echo "Uninstalling pre-commit"
		rm -f .git/hooks/pre-commit .git/hooks/commit-msg
		exit;;
	*)
		echo "Invalid option: $*"
		echo "Supported options: install, uninstall"
		exit 1;;
esac

# Run checks
flake8
black --check .
isort --check-only .
echo "All good to commit"
