#!/bin/bash
set -eu
# Check directory
cd "$(dirname "$0")"
[ -d .git ] || cd ../..
[ -d .git ]

pre_commit() {
	flake8
	black --check .
	isort --check-only .
}

commit_msg() {
	# $1 contains the file
	true
}

case "$(basename "$0") ${1:-run}" in
	"pre-commit run")
		pre_commit
		echo "All good to commit"
		;;
	"commit-msg "*)
		commit_msg "$1"
		;;
	"pre-commit install")
		echo "Installing pre-commit"
		cd .git/hooks
		ln -sf ../../pre-commit pre-commit
		[ -f commit-msg ] || ln -sf ../../pre-commit commit-msg
		;;
	"pre-commit uninstall")
		echo "Uninstalling pre-commit"
		rm -f .git/hooks/pre-commit .git/hooks/commit-msg
		;;
	*)
		echo "Invalid command: $*"
		echo "Supported options: install, uninstall"
esac
